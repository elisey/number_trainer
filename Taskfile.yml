version: "3"

vars:
  PROJECT_NAME: number-trainer
  PYTHON_CMD: python3
  UV_CMD: uv

tasks:
  default:
    desc: "–ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã"
    cmds:
      - task --list

  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
  install:
    desc: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    cmds:
      - "{{.UV_CMD}} sync"
      - "{{.UV_CMD}} add --group test pytest pytest-cov"
    sources:
      - pyproject.toml
    generates:
      - uv.lock

  install-dev:
    desc: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
    cmds:
      - "{{.UV_CMD}} add --group dev black isort flake8 mypy"
    deps: [install]

  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  run:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    cmds:
      - "{{.UV_CMD}} run {{.PYTHON_CMD}} main.py"

  run-console:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞"
    cmds:
      - "{{.UV_CMD}} run {{.PYTHON_CMD}} -m src.number_trainer.cli.console"

  # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  test:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"
    cmds:
      - "{{.UV_CMD}} run pytest tests/ -v"
    sources:
      - "src/**/*.py"
      - "tests/**/*.py"

  test-cov:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞"
    cmds:
      - "{{.UV_CMD}} run pytest tests/ --cov=src/number_trainer --cov-report=term-missing --cov-report=html"
    sources:
      - "src/**/*.py"
      - "tests/**/*.py"
    generates:
      - htmlcov/

  test-watch:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
    cmds:
      - "{{.UV_CMD}} run pytest tests/ -v --tb=short -x"
    watch: true
    sources:
      - "src/**/*.py"
      - "tests/**/*.py"

  # –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
  lint:
    desc: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –ª–∏–Ω—Ç–µ—Ä–∞–º–∏"
    deps: [install-dev]
    cmds:
      - "{{.UV_CMD}} run ruff check src/ tests/ main.py demo.py"
      - "{{.UV_CMD}} run mypy --package number_trainer --ignore-missing-imports"
      - "{{.UV_CMD}} run mypy main.py demo.py --ignore-missing-imports"

  format:
    desc: "–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥"
    deps: [install-dev]
    cmds:
      - "{{.UV_CMD}} run ruff format src/ tests/ main.py demo.py"

  format-check:
    desc: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
    deps: [install-dev]
    cmds:
      - "{{.UV_CMD}} run ruff format --check src/ tests/ main.py demo.py"
      - "{{.UV_CMD}} run ruff check src/ tests/ main.py demo.py"

  # CI/CD –∫–æ–º–∞–Ω–¥—ã
  ci:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∫ –≤ CI"
    cmds:
      - task: format-check
      - task: lint
      - task: test-cov

  # –û—á–∏—Å—Ç–∫–∞
  clean:
    desc: "–û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã"
    cmds:
      - rm -rf __pycache__/
      - rm -rf .pytest_cache/
      - rm -rf htmlcov/
      - rm -rf .coverage
      - rm -rf *.pyc
      - rm -rf .mypy_cache/
      - rm -rf .ruff_cache/

  clean-all:
    desc: "–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤–∫–ª—é—á–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ"
    cmds:
      - task: clean
      - rm -rf .venv/
      - rm -f uv.lock

  # –°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
  build:
    desc: "–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"
    cmds:
      - "{{.UV_CMD}} build"
    sources:
      - "*.py"
      - pyproject.toml
    generates:
      - dist/

  # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
  dev:
    desc: "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
    cmds:
      - task: install-dev
      - task: format
      - task: test
      - echo "‚úÖ –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≥–æ—Ç–æ–≤–∞!"

  # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ
  info:
    desc: "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–∞"
    cmds:
      - echo "–ü—Ä–æ–µ–∫—Ç{{":"}} {{.PROJECT_NAME}}"
      - echo "Python{{":"}} $({{.PYTHON_CMD}} --version)"
      - echo "UV{{":"}} $({{.UV_CMD}} --version)"
      - echo "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞{{":"}}"
      - find . -name "*.py" -o -name "*.toml" -o -name "*.yml" -o -name "*.md" | head -10

  # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
  demo:
    desc: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é math_trainer"
    cmds:
      - echo "üßÆ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Number Trainer"
      - echo "–ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤..."
      - "{{.UV_CMD}} run {{.PYTHON_CMD}} math_trainer.py"

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–µ–∫—Ç–∞
  health:
    desc: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –ø—Ä–æ–µ–∫—Ç–∞"
    cmds:
      - echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–µ–∫—Ç–∞..."
      - echo "üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞{{":"}}"
      - ls -la *.py *.toml *.md 2>/dev/null || echo "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"
      - echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤{{":"}}"
      - "{{.UV_CMD}} run {{.PYTHON_CMD}} -c \"import math_trainer; print('‚úÖ math_trainer OK')\""
      - "{{.UV_CMD}} run {{.PYTHON_CMD}} -c \"import tkinter; print('‚úÖ tkinter OK')\""
      - echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

  # –ü–æ–º–æ—â—å
  help:
    desc: "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –ø–æ–º–æ—â—å"
    cmds:
      - echo "üöÄ Number Trainer - –ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"
      - echo ""
      - echo "üì¶ –£–°–¢–ê–ù–û–í–ö–ê{{":"}}"
      - echo "  task install     - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
      - echo "  task install-dev - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
      - echo "  task dev         - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
      - echo ""
      - echo "üèÉ –ó–ê–ü–£–°–ö{{":"}}"
      - echo "  task run         - –ó–∞–ø—É—Å—Ç–∏—Ç—å GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
      - echo "  task run-console - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é"
      - echo "  task demo        - –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é"
      - echo ""
      - echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï{{":"}}"
      - echo "  task test        - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã"
      - echo "  task test-cov    - –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º"
      - echo "  task test-watch  - –¢–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
      - echo ""
      - echo "üîß –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê{{":"}}"
      - echo "  task lint        - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä–∞–º–∏"
      - echo "  task format      - –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥"
      - echo "  task ci          - –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ CI"
      - echo ""
      - echo "üßπ –û–ß–ò–°–¢–ö–ê{{":"}}"
      - echo "  task clean       - –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã"
      - echo "  task clean-all   - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞"
      - echo ""
      - echo "‚ÑπÔ∏è  –ò–ù–§–û–†–ú–ê–¶–ò–Ø{{":"}}"
      - echo "  task info        - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ"
      - echo "  task health      - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è"
      - echo "  task help        - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
